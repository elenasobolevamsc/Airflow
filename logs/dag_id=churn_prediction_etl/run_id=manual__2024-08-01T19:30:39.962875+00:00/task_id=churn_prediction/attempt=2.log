[2024-08-01T19:33:39.115+0000] {taskinstance.py:1979} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: churn_prediction_etl.churn_prediction manual__2024-08-01T19:30:39.962875+00:00 [queued]>
[2024-08-01T19:33:39.122+0000] {taskinstance.py:1979} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: churn_prediction_etl.churn_prediction manual__2024-08-01T19:30:39.962875+00:00 [queued]>
[2024-08-01T19:33:39.122+0000] {taskinstance.py:2193} INFO - Starting attempt 2 of 2
[2024-08-01T19:33:39.133+0000] {taskinstance.py:2217} INFO - Executing <Task(ClickHouseOperatorExtended): churn_prediction> on 2024-08-01 19:30:39.962875+00:00
[2024-08-01T19:33:39.140+0000] {standard_task_runner.py:60} INFO - Started process 312 to run task
[2024-08-01T19:33:39.143+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'churn_prediction_etl', 'churn_prediction', 'manual__2024-08-01T19:30:39.962875+00:00', '--job-id', '43', '--raw', '--subdir', 'DAGS_FOLDER/churn_prediction_etl.py', '--cfg-path', '/tmp/tmp3cmix98p']
[2024-08-01T19:33:39.146+0000] {standard_task_runner.py:88} INFO - Job 43: Subtask churn_prediction
[2024-08-01T19:33:39.185+0000] {task_command.py:423} INFO - Running <TaskInstance: churn_prediction_etl.churn_prediction manual__2024-08-01T19:30:39.962875+00:00 [running]> on host 16c05e324510
[2024-08-01T19:33:39.251+0000] {taskinstance.py:2513} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Smalch' AIRFLOW_CTX_DAG_ID='churn_prediction_etl' AIRFLOW_CTX_TASK_ID='churn_prediction' AIRFLOW_CTX_EXECUTION_DATE='2024-08-01T19:30:39.962875+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-08-01T19:30:39.962875+00:00'
[2024-08-01T19:33:39.258+0000] {base.py:83} INFO - Using connection ID 'clickhouse' for task execution.
[2024-08-01T19:33:39.259+0000] {clickhouse.py:79} INFO - DROP TABLE IF EXISTS telecom.tab1
[2024-08-01T19:33:39.262+0000] {clickhouse.py:79} INFO - DROP TABLE IF EXISTS telecom.tab2
[2024-08-01T19:33:39.263+0000] {clickhouse.py:79} INFO - DROP TABLE IF EXISTS telecom.data
[2024-08-01T19:33:39.265+0000] {clickhouse.py:79} INFO - CREATE TABLE telecom.tab1
ENGINE = MergeTree()
ORDER BY customerID
AS
SELECT customerID
	, BeginDate	
	, EndDate
	, Type
	, PaperlessBilling
	, PaymentMethod
	, MonthlyCharges
	, TotalCharges
	, IF(EndDate = 'No', 0, 1) AS Churn
	, IF(EndDate = 'No', '2020-02-01', EndDate) AS EndDate_new
FROM telecom.contract
[2024-08-01T19:33:39.294+0000] {clickhouse.py:79} INFO - ALTER TABLE telecom.tab1 DROP COLUMN EndDate
[2024-08-01T19:33:39.310+0000] {clickhouse.py:79} INFO - ALTER TABLE telecom.tab1 RENAME COLUMN EndDate_new TO EndDate
[2024-08-01T19:33:39.322+0000] {clickhouse.py:79} INFO - ALTER TABLE telecom.tab1
MODIFY COLUMN EndDate DateTime
[2024-08-01T19:33:39.342+0000] {clickhouse.py:79} INFO - CREATE TABLE telecom.tab2
ENGINE = MergeTree()
ORDER BY customerID
AS
SELECT customerID
	, Type
	, PaperlessBilling
	, PaymentMethod
	, MonthlyCharges
    , toFloat64OrZero(TotalCharges) AS TotalCharges
    , dateDiff('day', BeginDate, EndDate) AS Lifetime
    , Churn
FROM telecom.tab1
[2024-08-01T19:33:39.356+0000] {clickhouse.py:79} INFO - DROP TABLE telecom.tab1
[2024-08-01T19:33:39.357+0000] {clickhouse.py:79} INFO - CREATE TABLE telecom.data
ENGINE = MergeTree()
ORDER BY c.customerID
AS 
SELECT
    c.*,
    p.*,
    if(InternetService = '', 'No', InternetService) AS InternetService,
    if(OnlineSecurity = '', 'No', OnlineSecurity) AS OnlineSecurity,
    if(OnlineBackup = '', 'No', OnlineBackup) AS OnlineBackup,
    if(DeviceProtection = '', 'No', DeviceProtection) AS DeviceProtection,
    if(TechSupport = '', 'No', TechSupport) AS TechSupport,
    if(StreamingTV = '', 'No', StreamingTV) AS StreamingTV,
    if(StreamingMovies = '', 'No', StreamingMovies) AS StreamingMovies,
    if(MultipleLines = '', 'No', MultipleLines) AS MultipleLines

FROM telecom.tab2 AS c
LEFT JOIN telecom.personal AS p ON c.customerID = p.customerID
LEFT JOIN telecom.internet AS i ON c.customerID = i.customerID
LEFT JOIN telecom.phone AS ph ON c.customerID = ph.customerID
[2024-08-01T19:33:39.391+0000] {clickhouse.py:79} INFO - ALTER TABLE telecom.data DROP COLUMN p.customerID
[2024-08-01T19:33:39.412+0000] {clickhouse.py:79} INFO - DROP TABLE telecom.tab2
[2024-08-01T19:33:39.433+0000] {taskinstance.py:1149} INFO - Marking task as SUCCESS. dag_id=churn_prediction_etl, task_id=churn_prediction, execution_date=20240801T193039, start_date=20240801T193339, end_date=20240801T193339
[2024-08-01T19:33:39.475+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 0
[2024-08-01T19:33:39.494+0000] {taskinstance.py:3312} INFO - 1 downstream tasks scheduled from follow-on schedule check
